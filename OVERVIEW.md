# Повний огляд функціоналу LinkFlow (актуально)

## Основні можливості застосунку

1) Обробка Deep Links з QR-кодів
- Схема Android: `reich://` (реєструється в AndroidManifest через `<data android:scheme="reich"/>`).
- Нативна обробка в Android (`MainActivity`) — відкриття браузера без запуску Flutter UI для валідних deeplink.
- Flutter-обробка через `DeepLinkService` у складних сценаріях (алерти/ініціалізація).
- Автовідкриття браузера при валідному QR-коді.

2) Управління проєктами
- Створення / редагування / видалення проєктів.
- Автонумерація: `Проєкт N` (N = кількість збережених проєктів + 1).
- Валідація regex при збереженні.
- Валідація URL-шаблону (обов’язкова наявність `{key}`).
- Тестування проєкту перед збереженням.

3) Regex Matching з пріоритетами
- Вимоги до валідного матчу:
  - Рівно одне співпадіння
  - Хоча б одна група захоплення
  - Остання група використовується як `{key}`
- Порядок пріоритетів вибору «найкращого» матчу:
  1. Повне співпадіння (start == 0 && end == length відповідного рядка)
  2. Більше груп захоплення
  3. Довше співпадіння
  4. Раніший у списку проєктів
- Схема-агностичний матчинг (оновлено):
  - Спочатку regex застосовується до повного лінка `reich://...`
  - Якщо немає рівно одного співпадіння — regex застосовується до «хвоста» без префікса `reich://`
  - Таким чином, патерни можна писати БЕЗ фіксованої схеми. Рекомендовано писати regex лише для змінної частини, наприклад: `^(\d+)$` замість `^reich://(\d+)$`.

4) Фоновий режим
- ForegroundService для обробки у фоні.
- Автоматичне згортання UI на екранах з режимом `foregroundAuto`.
- Обробка QR-кодів у фоні.
- Повне закриття UI через `finishAndRemoveTask()` (щоб не залишалась «чорна карточка»).

5) Управління UI режимами
- `UiModeService` (централізовано):
  - `foregroundAuto` — дозволено автозгортання
  - `foregroundDisabled` — UI залишається активним
- Прив’язка до екранів:
  - `ProjectEdit` — disabled
  - `ProjectList`, `Settings`, Home — auto
- Тимчасові overrides для алертів і під час автентифікації.

6) Біометрична автентифікація
- Захист доступу до налаштувань (Face ID / Touch ID / пароль пристрою).

7) Обробка помилок та алерти
- `AlertService` з текстами з `core/alert_messages.dart`.
- Не валідний deeplink → показ у Flutter UI (через прапорець `pending_invalid_deeplink` або прямий MethodChannel виклик) + повернення на головний екран.

8) Збереження даних
- SharedPreferences локально на пристрої.
- Синхронізація для нативного коду: ключ `native_projects_json`.

9) Орієнтація екрану
- Портретна орієнтація: Android/iOS/Flutter налаштовані на portrait-only.

## Структура проєкту (скорочено)
```
lib/
  core/ (errors, alert_messages)
  models/ (project.dart)
  services/ (alert, auth, deep_link, regex_matching, storage, ui_mode, url)
  screens/ (project_list, project_edit, settings)
  main.dart
```

## Примітка щодо regex (оновлено)
- Рекомендовано НЕ включати фіксовану схему `reich://` у регулярні вирази.
- Пишіть патерн лише для змінної частини: `^(\d+)$`, `^1(\d+)$`, `^project/(\d+)$` і т.д.
- Додаток сам автоматично «обрізає» `reich://` для цілей співставлення, якщо це потрібно.
