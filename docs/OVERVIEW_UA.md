# Повний огляд функціоналу LinkFlow (актуалізовано)

## Основні можливості

1) Обробка Deep Links з QR-кодів
- Схема: `reich://` (реєструється в AndroidManifest через `<data android:scheme="reich"/>`)
- Нативна обробка в Android (`MainActivity`) без зайвого показу UI
- Flutter-обробка через `DeepLinkService` для додаткових сценаріїв
- Автоматичне відкриття браузера при валідному QR-коді
- ВАЖЛИВО: матчинг regex виконується по тілу посилання БЕЗ схеми. Якщо співпадіння не знайдено, виконується спроба по повному лінку. Це забезпечує зворотну сумісність зі старими патернами

2) Управління проєктами
- Створення / редагування / видалення
- Автоматична нумерація: `Проєкт N` (N = кількість збережених проєктів + 1)
- Валідація regex при збереженні
- Валідація URL шаблону (обовʼязкова наявність `{key}`)
- Тестування проєкту перед збереженням

3) Regex Matching з пріоритетами
- Критерії вибору найкращого співпадіння:
  1. Повне співпадіння
  2. Більше груп захоплення
  3. Довше співпадіння
  4. Порядок у списку проєктів
- Вимоги до regex:
  - Рівно одне співпадіння
  - Хоча б одна група захоплення
  - Остання група використовується як `{key}`
- Рекомендація: НЕ дублювати константну схему `reich://` у патернах. Пишіть патерни до змінної частини (тіла) посилання (див. приклади нижче)

4) Фоновий режим
- `ForegroundService` для роботи у фоні
- Автоматичне згортання UI на екранах з режимом `foregroundAuto`
- Обробка QR-кодів у фоні
- Закриття через `finishAndRemoveTask()` для відсутності «чорної карточки»

5) Управління UI режимами
- `UiModeService` (централізовано)
- Режими:
  - `foregroundAuto` — дозволено автозгортання
  - `foregroundDisabled` — UI залишається активним
- Призначення за екранами:
  - `ProjectEdit` — disabled
  - `ProjectList`, `Settings`, Home — auto
- Тимчасові override під час алертів та автентифікації

6) Біометрична автентифікація
- Доступ до налаштувань тільки після перевірки (Face ID / Touch ID / пароль пристрою)

7) Обробка помилок та алерти
- `AlertService` з уніфікованими повідомленнями (`core/alert_messages.dart`)
- Невалідний deep link:
  - Показ алерту у Flutter UI
  - Прапорець `pending_invalid_deeplink` для відкладеного показу
  - Після підтвердження — повернення на головний екран

8) Збереження даних
- Локально через `SharedPreferences`
- Для нативного коду Android зберігається `native_projects_json`

9) Орієнтація екрану
- Портретна орієнтація всюди (Android/iOS/Flutter)

---

## Приклади патернів (без схеми)
- Простий числовий ключ: `^(\d+)$`
- З префіксом «1»: `^1(\d+)$`
- Альфа-числовий ключ: `^(\w+)$`

Відповідні URL-шаблони:
- `https://example.com/item/{key}`
- `https://special.example.com/item/{key}`

Примітка: для старих патернів із схемою (наприклад, `^reich://(\d+)$`) збережено сумісність — спочатку перевіряється повний лінк, за потреби — тіло без схеми.
